<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campus Info Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="static/css/style.css" />
</head>

<body>
  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
  </div>

  <div class="notification" id="notification"></div>

  <div class="container">
    <div class="sidebar" id="sidebar">
      <div class="header">
        <h1><i class="fas fa-university"></i> Campus Info Hub</h1>
        <p>Report & Track Campus Incidents</p>
      </div>

      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="report" onclick="switchTab('report')">
          <i class="fas fa-plus-circle"></i> Report
        </button>
        <button class="nav-tab" data-tab="incidents" onclick="switchTab('incidents')">
          <i class="fas fa-list"></i> Incidents
        </button>
        <button class="nav-tab" data-tab="analytics" onclick="switchTab('analytics')">
          <i class="fas fa-chart-bar"></i> Analytics
        </button>
      </div>

      <div class="tab-content">
        <!-- Report Tab -->
        <div id="report-tab" class="tab-panel">
          <form id="incident-form">
            <div class="form-group">
              <label for="incident-type">Incident Type</label>
              <select id="incident-type" required>
                <option value="">Select Type</option>
                <option value="traffic_accident">Traffic Accident</option>
                <option value="traffic_jam">Traffic Jam</option>
                <option value="broken_facility">Broken Facility</option>
                <option value="noise">Noise Disturbance</option>
                <option value="road_block">Road Block</option>
                <option value="campus_activity">Campus Activity</option>
                <option value="security">Security Issue</option>
                <option value="maintenance">Maintenance</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label for="description">Description</label>
              <textarea id="description" rows="3" placeholder="Describe the incident..." required></textarea>
            </div>

            <div class="form-group">
              <label for="location">Location</label>
              <input type="text" id="location" placeholder="Click on map or enter location" required readonly>
            </div>

            <div class="form-group">
              <label for="severity">Severity</label>
              <select id="severity" required>
                <option value="">Select Severity</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="critical">Critical</option>
              </select>
            </div>

            <button type="submit" class="btn btn-full">
              <i class="fas fa-paper-plane"></i> Report Incident
            </button>
          </form>
        </div>

        <!-- Incidents Tab -->
        <div id="incidents-tab" class="tab-panel hidden">
          <div id="incidents-list">
            <!-- Incidents will be loaded here -->
          </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-panel hidden">
          <div class="analytics-buttons">
            <button class="analysis-btn" onclick="showAnalysisPopup('statistics')" data-analysis="statistics">
              <i class="fas fa-chart-pie"></i> Statistics
            </button>
            <button class="analysis-btn" onclick="showAnalysisPopup('charts')" data-analysis="charts">
              <i class="fas fa-chart-bar"></i> Charts
            </button>
            <button class="analysis-btn" onclick="showAnalysisPopup('clustering')" data-analysis="clustering">
              <i class="fas fa-project-diagram"></i> Clustering
            </button>
            <button class="analysis-btn" onclick="showAnalysisPopup('buffer')" data-analysis="buffer">
              <i class="fas fa-circle"></i> Buffer Analysis
            </button>
            <button class="analysis-btn" onclick="showAnalysisPopup('density')" data-analysis="density">
              <i class="fas fa-fire"></i> Density Map
            </button>
          </div>

          <!-- Analysis Popup Window -->
          <div id="analysis-popup" class="analysis-popup hidden">
            <div class="popup-header">
              <h3 id="popup-title">Analysis Results</h3>
              <button class="popup-close" onclick="closeAnalysisPopup()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="popup-content" id="popup-content">
              <!-- Analysis content will be loaded here -->
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="map-container">
      <div class="map-controls">
        <button class="control-btn" onclick="toggleSidebar()" title="Toggle Sidebar">
          <i class="fas fa-bars"></i>
        </button>
        <button class="control-btn" onclick="centerMap()" title="Center Map">
          <i class="fas fa-crosshairs"></i>
        </button>
        <button class="control-btn" id="heatmap-btn" onclick="toggleHeatmap()" title="Toggle Analysis Results">
          <i class="fas fa-fire"></i>
        </button>
        <button class="control-btn" id="incidents-btn" onclick="toggleIncidents()" title="Toggle Incidents">
          <i class="fas fa-exclamation-triangle"></i>
        </button>
        <button class="control-btn" id="filter-btn" onclick="showFilterPanel()" title="Filter Incidents">
          <i class="fas fa-filter"></i>
        </button>
        <button class="control-btn" id="export-btn" onclick="exportData()" title="Export Data">
          <i class="fas fa-download"></i>
        </button>
        <button class="control-btn" id="refresh-btn" onclick="refreshData()" title="Refresh Data">
          <i class="fas fa-sync-alt"></i>
        </button>
        <button class="control-btn" id="search-btn" onclick="showSearchPanel()" title="Search Location">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <div class="legend">
        <h4><i class="fas fa-info-circle"></i> Legend</h4>
        <div class="legend-item">
          <div class="legend-color" style="background: #ff4444;"></div>
          <span>Traffic Accidents</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ff8800;"></div>
          <span>Traffic Jams</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #4CAF50;"></div>
          <span>Campus Activities</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #2196F3;"></div>
          <span>Maintenance</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #9C27B0;"></div>
          <span>Other Issues</span>
        </div>
      </div>

      <div id="map"></div>
    </div>
  </div>

  <!-- Filter Panel -->
  <div id="filter-panel" class="floating-panel hidden">
    <div class="panel-header">
      <h4>Filter Incidents</h4>
      <button class="panel-close" onclick="hideFilterPanel()">×</button>
    </div>
    <div class="panel-content">
      <div class="filter-group">
        <label>Status:</label>
        <select id="status-filter">
          <option value="">All</option>
          <option value="active">Active</option>
          <option value="resolved">Resolved</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Severity:</label>
        <select id="severity-filter">
          <option value="">All</option>
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
          <option value="critical">Critical</option>
        </select>
      </div>
      <button class="btn btn-small" onclick="applyFilters()">Apply Filters</button>
      <button class="btn btn-small" onclick="clearFilters()">Clear</button>
    </div>
  </div>

  <!-- Search Panel -->
  <div id="search-panel" class="floating-panel hidden">
    <div class="panel-header">
      <h4>Search Location</h4>
      <button class="panel-close" onclick="hideSearchPanel()">×</button>
    </div>
    <div class="panel-content">
      <input type="text" id="search-input" placeholder="Enter coordinates (lat, lng) or description">
      <button class="btn btn-small" onclick="searchLocation()">Search</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="static/js/app.js"></script>
</body>