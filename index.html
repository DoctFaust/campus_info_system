<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campus Info Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100vh;
      overflow: hidden;
    }

    .container {
      display: flex;
      height: 100vh;
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
    }

    .sidebar {
      width: 350px;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

    .header {
      padding: 20px;
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .header p {
      opacity: 0.9;
      font-size: 14px;
    }

    .nav-tabs {
      display: flex;
      background: rgba(240, 240, 240, 0.8);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .nav-tab {
      flex: 1;
      padding: 15px 10px;
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 600;
      color: #666;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-tab.active {
      color: #4CAF50;
      background: rgba(76, 175, 80, 0.1);
    }

    .nav-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: #4CAF50;
    }

    .tab-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    .btn {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-full {
      width: 100%;
    }

    .incident-card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #4CAF50;
      transition: all 0.3s ease;
    }

    .incident-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .incident-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .incident-type {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
    }

    .incident-time {
      color: #666;
      font-size: 12px;
    }

    .incident-description {
      color: #333;
      line-height: 1.4;
      margin-bottom: 8px;
    }

    .incident-location {
      color: #666;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .map-container {
      flex: 1;
      position: relative;
      background: #f0f0f0;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    .map-controls {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .control-btn {
      background: rgba(255, 255, 255, 0.95);
      border: none;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      color: #333;
    }

    .control-btn:hover {
      background: #4CAF50;
      color: white;
      transform: scale(1.1);
    }

    .legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.95);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      min-width: 200px;
    }

    .legend h4 {
      margin-bottom: 10px;
      color: #333;
      font-size: 14px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      font-size: 12px;
      color: #666;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .stat-value {
      font-size: 2.5em;
      font-weight: bold;
      color: #4CAF50;
      margin-bottom: 5px;
    }

    .stat-label {
      color: #666;
      font-size: 14px;
      font-weight: 600;
    }

    .chart-container {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .chart-container h3 {
      margin-bottom: 15px;
      color: #333;
      text-align: center;
    }

    #chart {
      width: 100%;
      height: 300px;
    }

    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top: 5px solid #4CAF50;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .hidden {
      display: none;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4CAF50;
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 10000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        position: absolute;
        z-index: 1000;
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .map-container {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
  </div>

  <div class="notification" id="notification"></div>

  <div class="container">
    <div class="sidebar" id="sidebar">
      <div class="header">
        <h1><i class="fas fa-university"></i> Campus Info Hub</h1>
        <p>Report & Track Campus Incidents</p>
      </div>

      <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('report')">
          <i class="fas fa-plus-circle"></i> Report
        </button>
        <button class="nav-tab" onclick="switchTab('incidents')">
          <i class="fas fa-list"></i> Incidents
        </button>
        <button class="nav-tab" onclick="switchTab('analytics')">
          <i class="fas fa-chart-bar"></i> Analytics
        </button>
      </div>

      <div class="tab-content">
        <!-- Report Tab -->
        <div id="report-tab" class="tab-panel">
          <form id="incident-form">
            <div class="form-group">
              <label for="incident-type">Incident Type</label>
              <select id="incident-type" required>
                <option value="">Select Type</option>
                <option value="traffic_accident">Traffic Accident</option>
                <option value="traffic_jam">Traffic Jam</option>
                <option value="broken_facility">Broken Facility</option>
                <option value="noise">Noise Disturbance</option>
                <option value="road_block">Road Block</option>
                <option value="campus_activity">Campus Activity</option>
                <option value="security">Security Issue</option>
                <option value="maintenance">Maintenance</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label for="description">Description</label>
              <textarea id="description" rows="3" placeholder="Describe the incident..." required></textarea>
            </div>

            <div class="form-group">
              <label for="location">Location</label>
              <input type="text" id="location" placeholder="Click on map or enter location" required readonly>
            </div>

            <div class="form-group">
              <label for="severity">Severity</label>
              <select id="severity" required>
                <option value="">Select Severity</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="critical">Critical</option>
              </select>
            </div>

            <button type="submit" class="btn btn-full">
              <i class="fas fa-paper-plane"></i> Report Incident
            </button>
          </form>
        </div>

        <!-- Incidents Tab -->
        <div id="incidents-tab" class="tab-panel hidden">
          <div id="incidents-list">
            <!-- Incidents will be loaded here -->
          </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-panel hidden">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="total-incidents">42</div>
              <div class="stat-label">Total Incidents</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="active-incidents">8</div>
              <div class="stat-label">Active Today</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="resolved-incidents">34</div>
              <div class="stat-label">Resolved</div>
            </div>
          </div>

          <div class="chart-container">
            <h3>Incident Types Distribution</h3>
            <canvas id="chart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="map-container">
      <div class="map-controls">
        <button class="control-btn" onclick="toggleSidebar()" title="Toggle Sidebar">
          <i class="fas fa-bars"></i>
        </button>
        <button class="control-btn" onclick="centerMap()" title="Center Map">
          <i class="fas fa-crosshairs"></i>
        </button>
        <button class="control-btn" onclick="toggleHeatmap()" title="Toggle Heatmap">
          <i class="fas fa-fire"></i>
        </button>
      </div>

      <div class="legend">
        <h4><i class="fas fa-info-circle"></i> Legend</h4>
        <div class="legend-item">
          <div class="legend-color" style="background: #ff4444;"></div>
          <span>Traffic Accidents</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ff8800;"></div>
          <span>Traffic Jams</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #4CAF50;"></div>
          <span>Campus Activities</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #2196F3;"></div>
          <span>Maintenance</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #9C27B0;"></div>
          <span>Other Issues</span>
        </div>
      </div>

      <div id="map"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script>
    // Global variables
    let map;
    let markers = [];
    let incidents = [];
    let selectedLocation = null;
    let chart = null;

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function () {
      initMap();
      loadSampleData();
      initChart();
      setupEventListeners();
    });

    // Initialize the map
    function initMap() {
      // Default to a university location (you can change coordinates)
      map = L.map('map').setView([40.7589, -73.9851], 16);

      // Add OpenStreetMap tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      // Add click event for location selection
      map.on('click', function (e) {
        if (document.getElementById('report-tab').classList.contains('hidden') === false) {
          selectLocation(e.latlng);
        }
      });
    }

    // Select location on map
    function selectLocation(latlng) {
      selectedLocation = latlng;
      document.getElementById('location').value = `${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`;

      // Remove previous selection marker
      if (window.selectionMarker) {
        map.removeLayer(window.selectionMarker);
      }

      // Add new selection marker
      window.selectionMarker = L.marker(latlng, {
        icon: L.divIcon({
          className: 'selection-marker',
          html: '<i class="fas fa-map-pin" style="color: #ff4444; font-size: 24px;"></i>',
          iconSize: [30, 30],
          iconAnchor: [15, 30]
        })
      }).addTo(map);
    }

    // Load sample data
    function loadSampleData() {
      const sampleIncidents = [
        {
          id: 1,
          type: 'traffic_accident',
          description: 'Minor collision at main entrance',
          location: [40.7589, -73.9851],
          severity: 'medium',
          timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000),
          status: 'active'
        },
        {
          id: 2,
          type: 'broken_facility',
          description: 'Broken water fountain in library',
          location: [40.7599, -73.9841],
          severity: 'low',
          timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000),
          status: 'resolved'
        },
        {
          id: 3,
          type: 'campus_activity',
          description: 'Student concert at main quad',
          location: [40.7579, -73.9861],
          severity: 'low',
          timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000),
          status: 'active'
        },
        {
          id: 4,
          type: 'road_block',
          description: 'Construction blocking north entrance',
          location: [40.7605, -73.9835],
          severity: 'high',
          timestamp: new Date(Date.now() - 6 * 60 * 60 * 1000),
          status: 'active'
        },
        {
          id: 5,
          type: 'noise',
          description: 'Loud construction work near dormitory',
          location: [40.7585, -73.9875],
          severity: 'medium',
          timestamp: new Date(Date.now() - 30 * 60 * 1000),
          status: 'active'
        }
      ];

      incidents = sampleIncidents;
      updateMapMarkers();
      updateIncidentsList();
      updateAnalytics();
    }

    // Update map markers
    function updateMapMarkers() {
      // Clear existing markers
      markers.forEach(marker => map.removeLayer(marker));
      markers = [];

      const colorMap = {
        'traffic_accident': '#ff4444',
        'traffic_jam': '#ff8800',
        'broken_facility': '#9C27B0',
        'noise': '#795548',
        'road_block': '#607D8B',
        'campus_activity': '#4CAF50',
        'security': '#f44336',
        'maintenance': '#2196F3',
        'other': '#9E9E9E'
      };

      incidents.forEach(incident => {
        const color = colorMap[incident.type] || '#9E9E9E';
        const marker = L.marker(incident.location, {
          icon: L.divIcon({
            className: 'incident-marker',
            html: `<div style="
                            background: ${color};
                            width: 20px;
                            height: 20px;
                            border-radius: 50%;
                            border: 3px solid white;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                            ${incident.status === 'active' ? 'animation: pulse 2s infinite;' : 'opacity: 0.7;'}
                        "></div>`,
            iconSize: [26, 26],
            iconAnchor: [13, 13]
          })
        }).addTo(map);

        marker.bindPopup(`
                    <div style="min-width: 200px;">
                        <h4 style="color: ${color}; margin-bottom: 8px;">
                            ${incident.type.replace('_', ' ').toUpperCase()}
                        </h4>
                        <p style="margin-bottom: 8px;">${incident.description}</p>
                        <small style="color: #666;">
                            ${incident.timestamp.toLocaleString()}
                        </small>
                        <div style="margin-top: 8px;">
                            <span style="
                                background: ${incident.status === 'active' ? '#4CAF50' : '#9E9E9E'};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 11px;
                            ">${incident.status.toUpperCase()}</span>
                        </div>
                    </div>
                `);

        markers.push(marker);
      });
    }

    // Update incidents list
    function updateIncidentsList() {
      const container = document.getElementById('incidents-list');
      container.innerHTML = '';

      const sortedIncidents = incidents.sort((a, b) => b.timestamp - a.timestamp);

      sortedIncidents.forEach(incident => {
        const card = document.createElement('div');
        card.className = 'incident-card';
        card.innerHTML = `
                    <div class="incident-header">
                        <div class="incident-type">${incident.type.replace('_', ' ')}</div>
                        <div class="incident-time">${formatTimeAgo(incident.timestamp)}</div>
                    </div>
                    <div class="incident-description">${incident.description}</div>
                    <div class="incident-location">
                        <i class="fas fa-map-marker-alt"></i>
                        ${incident.location[0].toFixed(4)}, ${incident.location[1].toFixed(4)}
                    </div>
                `;

        card.addEventListener('click', () => {
          map.setView(incident.location, 18);
          markers.find(m => m.getLatLng().lat === incident.location[0])?.openPopup();
        });

        container.appendChild(card);
      });
    }

    // Update analytics
    function updateAnalytics() {
      const total = incidents.length;
      const active = incidents.filter(i => i.status === 'active').length;
      const resolved = incidents.filter(i => i.status === 'resolved').length;

      document.getElementById('total-incidents').textContent = total;
      document.getElementById('active-incidents').textContent = active;
      document.getElementById('resolved-incidents').textContent = resolved;

      updateChart();
    }

    // Initialize chart
    function initChart() {
      const ctx = document.getElementById('chart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: [],
          datasets: [{
            data: [],
            backgroundColor: [
              '#ff4444', '#ff8800', '#4CAF50', '#2196F3',
              '#9C27B0', '#795548', '#607D8B', '#f44336', '#9E9E9E'
            ],
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    // Update chart
    function updateChart() {
      const typeCounts = {};
      incidents.forEach(incident => {
        typeCounts[incident.type] = (typeCounts[incident.type] || 0) + 1;
      });

      chart.data.labels = Object.keys(typeCounts).map(type =>
        type.replace('_', ' ').toUpperCase()
      );
      chart.data.datasets[0].data = Object.values(typeCounts);
      chart.update();
    }

    // Setup event listeners
    function setupEventListeners() {
      document.getElementById('incident-form').addEventListener('submit', function (e) {
        e.preventDefault();
        submitIncident();
      });
    }

    // Submit incident
    function submitIncident() {
      if (!selectedLocation) {
        showNotification('Please select a location on the map', 'error');
        return;
      }

      const formData = {
        type: document.getElementById('incident-type').value,
        description: document.getElementById('description').value,
        location: [selectedLocation.lat, selectedLocation.lng],
        severity: document.getElementById('severity').value,
        timestamp: new Date(),
        status: 'active',
        id: incidents.length + 1
      };

      showLoading();

      // Simulate API call
      setTimeout(() => {
        incidents.push(formData);
        updateMapMarkers();
        updateIncidentsList();
        updateAnalytics();

        // Reset form
        document.getElementById('incident-form').reset();
        if (window.selectionMarker) {
          map.removeLayer(window.selectionMarker);
        }
        selectedLocation = null;

        hideLoading();
        showNotification('Incident reported successfully!', 'success');
      }, 1000);
    }

    // Tab switching
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.add('hidden'));
      document.getElementById(tabName + '-tab').classList.remove('hidden');

      // Load data for analytics tab
      if (tabName === 'analytics') {
        updateAnalytics();
      }
    }

    // Utility functions
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    function centerMap() {
      map.setView([40.7589, -73.9851], 16);
    }

    function toggleHeatmap() {
      showNotification('Heatmap toggle feature coming soon!', 'info');
    }

    function formatTimeAgo(date) {
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 60) return `${diffMins}m ago`;
      if (diffHours < 24) return `${diffHours}h ago`;
      return `${diffDays}d ago`;
    }
